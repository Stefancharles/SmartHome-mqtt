//
// Created by eroneko on 2020/9/15.
//

#include "../lcd/lcd.h"

char colon[][29] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0xF8, 0xF8, 0xF8,
        0x00, 0x00, 0x00, 0x00, 0xF8, 0xF8, 0xF8, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00
};

unsigned char number[][16 * 29 / 8] = {
        /*--  文字:  0  --*/
/*--  Impact18;  此字体下对应的点阵为：宽x高=13x29   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x29  --*/
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xC0, 0x7F, 0xF0, 0x7F, 0xF0,
        0xFF, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8,
        0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFF, 0xF8, 0x7F, 0xF0, 0x7F, 0xF0, 0x3F, 0xE0,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

/*--  文字:  1  --*/
/*--  Impact18;  此字体下对应的点阵为：宽x高=13x29   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x29  --*/
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x80, 0x1F, 0x80, 0x7F, 0x80,
        0xFF, 0x80, 0xFF, 0x80, 0x3F, 0x80, 0x3F, 0x80, 0x1F, 0x80, 0x1F, 0x80, 0x1F, 0x80, 0x1F, 0x80,
        0x1F, 0x80, 0x1F, 0x80, 0x1F, 0x80, 0x1F, 0x80, 0x1F, 0x80, 0x1F, 0x80, 0x1F, 0x80, 0x1F, 0x80,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

/*--  文字:  2  --*/
/*--  Impact18;  此字体下对应的点阵为：宽x高=13x29   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x29  --*/
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xC0, 0x7F, 0xE0, 0xFF, 0xF0,
        0xFF, 0xF0, 0xFF, 0xF0, 0xFF, 0xF0, 0xFF, 0xF0, 0x07, 0xF0, 0x07, 0xE0, 0x0F, 0xE0, 0x1F, 0xC0,
        0x1F, 0x80, 0x3F, 0x80, 0x7F, 0x00, 0x7E, 0x00, 0xFE, 0x00, 0xFF, 0xF0, 0xFF, 0xF0, 0xFF, 0xF0,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

/*--  文字:  3  --*/
/*--  Impact18;  此字体下对应的点阵为：宽x高=13x29   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x29  --*/
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xE0, 0x7F, 0xF0, 0xFF, 0xF0,
        0xFF, 0xF0, 0xFF, 0xF8, 0xFF, 0xF8, 0x03, 0xF0, 0x0F, 0xF0, 0x0F, 0xE0, 0x0F, 0xF0, 0x03, 0xF8,
        0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFF, 0xF8, 0xFF, 0xF0, 0x7F, 0xF0, 0x3F, 0xE0,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

/*--  文字:  4  --*/
/*--  Impact18;  此字体下对应的点阵为：宽x高=13x29   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x29  --*/
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xE0, 0x1F, 0xE0, 0x1F, 0xE0,
        0x3F, 0xE0, 0x3F, 0xE0, 0x3F, 0xE0, 0x7F, 0xE0, 0x7F, 0xE0, 0x7F, 0xE0, 0xFF, 0xE0, 0xFF, 0xE0,
        0xFF, 0xE0, 0xFF, 0xF8, 0xFF, 0xF8, 0xFF, 0xF8, 0xFF, 0xF8, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

/*--  文字:  5  --*/
/*--  Impact18;  此字体下对应的点阵为：宽x高=13x29   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x29  --*/
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xF0, 0xFF, 0xF0, 0xFF, 0xF0,
        0xFC, 0x00, 0xFC, 0x00, 0xFF, 0xE0, 0xFF, 0xF0, 0xFF, 0xF8, 0xFF, 0xF8, 0xFD, 0xF8, 0x01, 0xF8,
        0x01, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFF, 0xF8, 0x7F, 0xF8, 0x7F, 0xF0, 0x3F, 0xE0,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

/*--  文字:  6  --*/
/*--  Impact18;  此字体下对应的点阵为：宽x高=13x29   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x29  --*/
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xE0, 0x7F, 0xF0, 0x7F, 0xF0,
        0xFD, 0xF8, 0xFD, 0xF8, 0xFC, 0x00, 0xFF, 0xE0, 0xFF, 0xF0, 0xFF, 0xF8, 0xFF, 0xF8, 0xFD, 0xF8,
        0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFF, 0xF8, 0x7F, 0xF0, 0x7F, 0xF0, 0x3F, 0xE0,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

/*--  文字:  7  --*/
/*--  Impact18;  此字体下对应的点阵为：宽x高=13x29   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x29  --*/
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xC0, 0xFF, 0xC0, 0xFF, 0xC0,
        0x0F, 0xC0, 0x1F, 0xC0, 0x1F, 0x80, 0x1F, 0x80, 0x1F, 0x80, 0x1F, 0x80, 0x1F, 0x80, 0x3F, 0x00,
        0x3F, 0x00, 0x3F, 0x00, 0x3F, 0x00, 0x3F, 0x00, 0x7F, 0x00, 0x7E, 0x00, 0x7E, 0x00, 0x7E, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

/*--  文字:  8  --*/
/*--  Impact18;  此字体下对应的点阵为：宽x高=13x29   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x29  --*/
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xE0, 0x7F, 0xF0, 0x7F, 0xF0,
        0xFF, 0xF8, 0xFF, 0xF8, 0xFF, 0xF8, 0xFF, 0xF8, 0x7F, 0xF0, 0x3F, 0xE0, 0x7F, 0xF0, 0xFF, 0xF8,
        0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFF, 0xF8, 0x7F, 0xF0, 0x7F, 0xF0, 0x3F, 0xE0,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

/*--  文字:  9  --*/
/*--  Impact18;  此字体下对应的点阵为：宽x高=13x29   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=16x29  --*/
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xE0, 0x7F, 0xF0, 0x7F, 0xF0,
        0xFF, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0xFF, 0xF8, 0xFF, 0xF8,
        0x7F, 0xF8, 0x3F, 0xF8, 0x01, 0xF8, 0xFD, 0xF8, 0xFD, 0xF8, 0x7F, 0xF0, 0x7F, 0xF0, 0x3F, 0xE0,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};
unsigned char dot[][16 * 29 / 8] =
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x7C, 0x00, 0x7C,
         0x00,
         0x3C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//对给定单字符数组中的所有字节进行遍历，从各个字节中取出相应像素点并计算每个像素点的坐标
void draw_word(int x, int y, char s[], int w, int h, int color, int *plcd) {
    int count = 0;
    int i, j;
    for (i = 0; i < h * w / 8; i++) {//点阵字体中共有宽度/8*高度个字节
        for (j = 0; j < 8; j++) {//每个字节存储八位，即八个像素点
            if ((s[i] >> (7 - j)) & 1 == 1) {//像素点从左到右存储在元素中，即最高位存储最左边的像素点
                draw_point(count % w + x, y + count / w, color, plcd);
                //遍历像素点的次数由count记录，则count = x+y*w
            }//由此得count对宽取余得到x的坐标，除以宽取整得到y的坐标（未考虑偏移量）
            count++;
        }
    }
}

void draw_num(int x, int y, int num, int w, int h, int color, int *plcd) {
    if (num == 0) {
        draw_word(x, y, number[0], 16, 29, color, plcd);
        return;
    }
    int count = 0;
    int n = num;
    while (num) {
        count++;
        num = num / 10;
    }
    int i, a;
    for (i = 0; i < count; i++) {
        draw_word(x + ((count - i - 1) * 16), y, number[n % 10], 16, 29, color, plcd);
        n = n / 10;
    }
}

void draw_time(int x, int y, int hour, int min, int sec, int color, int plcd) {
    draw_rectangle(x, y, 120, 29, 0x0, plcd);
    if (hour == 0) {
        draw_num(x, y, 0, 16, 29, color, plcd);
        draw_num(x + 16, y, 0, 16, 29, color, plcd);
    } else if (hour > 0 && hour <= 9) {
        draw_num(x, y, 0, 16, 29, color, plcd);
        draw_num(x + 16, y, hour, 16, 29, color, plcd);
    } else {
        draw_num(x, y, hour, 16, 29, color, plcd);
    }
    draw_word(x + 32, y, colon[0], 8, 29, color, plcd);
    if (min == 0) {
        draw_num(x + 41, y, 0, 16, 29, color, plcd);
        draw_num(x + 57, y, 0, 16, 29, color, plcd);
    } else if (min > 0 && min <= 9) {
        draw_num(x + 41, y, 0, 16, 29, color, plcd);
        draw_num(x + 57, y, min, 16, 29, color, plcd);
    } else {
        draw_num(x + 41, y, min, 16, 29, color, plcd);
    }
    draw_word(x + 72, y, colon[0], 8, 29, color, plcd);
    if (sec == 0) {
        draw_num(x + 81, y, 0, 16, 29, color, plcd);
        draw_num(x + 97, y, 0, 16, 29, color, plcd);
    } else if (sec > 0 && sec <= 9) {
        draw_num(x + 81, y, 0, 16, 29, color, plcd);
        draw_num(x + 97, y, sec, 16, 29, color, plcd);
    } else {
        draw_num(x + 81, y, sec, 16, 29, color, plcd);
    }
}

void draw_num_tail(int x, int y, int num, int w, int h, int color, int *plcd, int tail) {
    int count = 0;
    int tcount = 0;
    int n = num;
    int k = tail;
    while (num) {
        count++;
        num = num / 10;
    }
    while (tail) {
        tcount++;
        tail = tail / 10;
    }
    int i;
    for (i = 0; i < count; i++) {
        draw_word(x + ((count - i - 1) * 16), y, number[n % 10], 16, 29, color, plcd);
        n = n / 10;
    }
    if (k != 0) {
        draw_word(x + (count) * 17, y, dot[0], 16, 29, color, plcd);
        for (i = 0; i < tcount; i++) {
            draw_word(x + ((count + tcount - i) * 16), y, number[k % 10], 16, 29, color, plcd);
            k = k / 10;
        }
    } else {
        draw_word(x + count, y, number[0], 16, 29, color, plcd);
        draw_word(x + count + 16, y, number[0], 16, 29, color, plcd);
    }
}
//
//int main() {
//    int *plcd = get_p("/dev/fb0");
//    draw_num(400,200,123456789,16,29,0x0,plcd);
//}